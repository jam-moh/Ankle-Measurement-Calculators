<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Predictive Ankle Torque Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,#e0f2fe,#fef3c7);
  color:#111;
  margin:0;
}
.container{
  max-width:1000px;
  margin:auto;
  padding:30px;
}
h1{text-align:center;color:#2563eb;}
.card{
  background:white;
  border-radius:16px;
  padding:20px;
  margin-bottom:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
.controls{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
}
label{font-weight:600;}
input, select{
  width:100%;
  padding:8px;
  font-size:1rem;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  padding:10px 16px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
  background:#2563eb;
  color:white;
}
canvas{width:100%;height:300px;}
.summary{
  margin-top:15px;
  padding:15px;
  border-radius:12px;
  background:#f1f5f9;
  font-size:1rem;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
}
th{background:#e5e7eb;}

 /* üîπ Back to landing page button */
    .back-home {
      align-self: flex-start;
      margin-bottom: 15px;
      padding: 6px 12px;
      background-color: rgba(255,255,255,0.15);
      color: #00ffd5;
      text-decoration: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .back-home:hover {
      background-color: rgba(255,255,255,0.25);
    }
  
</style>
</head>
<body>

  <a href="https://jam-moh.github.io/Ankle-Measurement-Calculators/"
   class="back-home">
  ‚Üê Back to Landing Page
</a>
  
<div class="container">
<h1>Predictive Ankle Torque Calculator</h1>

<div class="card controls">
  <div>
    <label>Age (years)</label>
    <input type="number" id="age" min="5" max="80" value="0">
  </div>
  <div>
    <label>Height (cm)</label>
    <input type="number" id="height" min="120" max="220" value="0">
  </div>
  <div>
    <label>Sex</label>
    <select id="sex">
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  </div>
</div>

<div class="card">
  <canvas id="plot" width="1000" height="300"></canvas>
  <div class="summary" id="summary"></div>
  <button onclick="resetApp()">Reset</button>
</div>

<div class="card">
<h3>Normative Reference Values (Plantar Flexion Torque, N¬∑m)</h3>
<table>
<tr><th>Age (years)</th><th>Male Mean (SD)</th><th>Female Mean (SD)</th></tr>
<tr><td>5‚Äì9</td><td>33.3 (8.9)</td><td>39.0 (5.6)</td></tr>
<tr><td>10‚Äì14</td><td>81.3 (28.3)</td><td>79.2 (31.9)</td></tr>
<tr><td>15‚Äì19</td><td>120.8 (35.4)</td><td>102.0 (20.9)</td></tr>
<tr><td>20‚Äì29</td><td>121.9 (25.7)</td><td>103.7 (19.4)</td></tr>
<tr><td>30‚Äì39</td><td>116.6 (25.7)</td><td>107.1 (23.2)</td></tr>
<tr><td>40‚Äì49</td><td>118.5 (26.3)</td><td>98.4 (20.9)</td></tr>
<tr><td>50‚Äì59</td><td>113.2 (10.5)</td><td>86.3 (20.2)</td></tr>
<tr><td>60‚Äì69</td><td>104.6 (29.5)</td><td>90.2 (25.6)</td></tr>
<tr><td>70‚Äì80</td><td>117.5 (21.9)</td><td>75.6 (21.0)</td></tr>
</table>
<p><em>Reference:</em> Moraux, A., Canal, A., Ollivier, G., Ledoux, I., Doppler, V., Payan, C., & Hogrel, J. Y. (2013). Ankle dorsi-and plantar-flexion torques measured by dynamometry in healthy subjects from 5 to 80 years. BMC Musculoskeletal Disorders, 14(1), 104.</p>
</div>
</div>

<script>
// Log-linear predictive model coefficients
const model = {
  left:{intercept:3.580,height:0.00698,age:-0.004260,sex:0.0983},
  right:{intercept:3.735,height:0.00618,age:-0.003320,sex:0.1121}
};

// Normative plantar-flexion table
const plantarFlexNorms = [
  {min:5,max:9, male:{mean:33.3, sd:8.9}, female:{mean:39.0, sd:5.6}},
  {min:10,max:14, male:{mean:81.3, sd:28.3}, female:{mean:79.2, sd:31.9}},
  {min:15,max:19, male:{mean:120.8, sd:35.4}, female:{mean:102.0, sd:20.9}},
  {min:20,max:29, male:{mean:121.9, sd:25.7}, female:{mean:103.7, sd:19.4}},
  {min:30,max:39, male:{mean:116.6, sd:25.7}, female:{mean:107.1, sd:23.2}},
  {min:40,max:49, male:{mean:118.5, sd:26.3}, female:{mean:98.4, sd:20.9}},
  {min:50,max:59, male:{mean:113.2, sd:10.5}, female:{mean:86.3, sd:20.2}},
  {min:60,max:69, male:{mean:104.6, sd:29.5}, female:{mean:90.2, sd:25.6}},
  {min:70,max:80, male:{mean:117.5, sd:21.9}, female:{mean:75.6, sd:21.0}}
];

const ctx = document.getElementById("plot").getContext("2d");
const ageEl = document.getElementById("age");
const heightEl = document.getElementById("height");
const sexEl = document.getElementById("sex");
const summaryEl = document.getElementById("summary");

// Predict torque
function predictTorque(side, age, height, sex){
  const sexVal = sex==="male"?1:0;
  const lnTorque = model[side].intercept + model[side].height*height + model[side].age*age + model[side].sex*sexVal;
  return Math.exp(lnTorque);
}

// Interpret torque against norms
function interpretTorque(torque, age, sex){
  const bracket = plantarFlexNorms.find(b => age>=b.min && age<=b.max);
  if(!bracket) return "Age out of range";
  const norm = bracket[sex];
  if(torque < norm.mean - norm.sd) return "below expected range";
  else if(torque > norm.mean + norm.sd) return "above expected range";
  else return "within expected range";
}

// Draw graph
function draw(){
  const age = +ageEl.value;
  const height = +heightEl.value;
  const sex = sexEl.value;

  if(age===0 || height===0){
    ctx.clearRect(0,0,1000,300);
    summaryEl.textContent = "";
    return;
  }

  const left = predictTorque("left",age,height,sex);
  const right = predictTorque("right",age,height,sex);

  ctx.clearRect(0,0,1000,300);
  const min = 0;
  const max = Math.max(left,right)*1.3;
  function x(v){ return v/max*1000; }

  // Left
  ctx.fillStyle="#dcfce7";
  ctx.fillRect(0,50,x(left),60);
  ctx.fillStyle="#2563eb";
  ctx.beginPath();
  ctx.arc(x(left),80,10,0,2*Math.PI);
  ctx.fill();
  ctx.fillStyle="#111";
  ctx.fillText("Left: "+left.toFixed(1)+" N¬∑m",x(left)+15,85);

  // Right
  ctx.fillStyle="#fde68a";
  ctx.fillRect(0,150,x(right),60);
  ctx.fillStyle="#2563eb";
  ctx.beginPath();
  ctx.arc(x(right),180,10,0,2*Math.PI);
  ctx.fill();
  ctx.fillStyle="#111";
  ctx.fillText("Right: "+right.toFixed(1)+" N¬∑m",x(right)+15,185);

  summaryEl.innerHTML =
    `Left ankle torque: ${left.toFixed(1)} N¬∑m ‚Äî ${interpretTorque(left,age,sex)}.<br>`+
    `Right ankle torque: ${right.toFixed(1)} N¬∑m ‚Äî ${interpretTorque(right,age,sex)}.`;
}

// Reset
function resetApp(){
  ageEl.value = 0;
  heightEl.value = 0;
  sexEl.value = "male";
  draw();
}

[ageEl,heightEl,sexEl].forEach(el=>el.oninput=draw);
draw();
</script>
</body>
</html>
